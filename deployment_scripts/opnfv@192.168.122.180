#!/bin/bash

# Fuel Plugin - OPNFV Resource Managment (Doctor)
#
# https://wiki.opnfv.org/display/doctor
#
# Version 9.0

CEILOMETER_CONF_DIR=/etc/ceilometer


if [ -e $CEILOMETER_CONF_DIR/event_pipeline.yaml ]; then
    if ! grep -q '^ *- notifier://?topic=alarm.all$' $CEILOMETER_CONF_DIR/event_pipeline.yaml; then
        sed -i '/^ *publishers:$/,+1s|^\( *\)-.*$|\1- notifier://?topic=alarm.all\n&|' $CEILOMETER_CONF_DIR/event_pipeline.yaml
    fi
fi

service ceilometer-agent-notification restart

exit 0

